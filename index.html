<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Project Purgatory</title>
  </head>
  <body style="background-color:black; color: white">
      <script src="http://ondras.github.com/rot.js/rot.js"></script>
      <script>
        //One global to rule them all
        PP = {};
        PP.save = {};
        PP.save.list = function()
        {
          var count  = 5;
          var list = [];
          for( var i = 0 ; i < count ; i++ )
          {
            if(!localStorage["save"+i])
            {
              list.push( (i+1) + ") New Game")
            }
            else
            {
              list.push( (i+1) + ") " + JSON.parse( "save"+i ).description )
            }
          }
          return list;
        }
        PP.kb = { next : {} , listening : false }; //Keyboard
        
        //Are we ready for some ROT times ?
        if( !ROT.isSupported() )
          alert( "This game will not run on your 'browser'" );
        else
          start();
          
        function start()
        {
          //Display
          if( !PP.display )
          {
            PP.display = new ROT.Display({width:80, height:50});
            document.body.appendChild( PP.display.getContainer() );
          }
          //Keyboard
          if( !PP.kb.listening )
          {
            document.addEventListener("keydown", function(e) 
            {
              var code = e.keyCode;
              var vk = "?"; /* find the corresponding constant */
              for (var name in ROT) 
              {
                if (ROT[name] == code && name.indexOf("VK_") == 0) { vk = name; }
              }
              console.log( "Keydown: code is " + code + " (" + vk + ")" );
              if( pp.kb.next )
              {
                pp.kb.next( code, vk );
              }
            });
          }
          PP.display.drawText( 5 ,  2 , "Project Pandora" );
          var list = PP.save.list();
          list.forEach( function( v,i){ PP.display.drawText( 5 ,  10+i , v );  });
          
        }
    </script>
  </body>
</html>
